<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="uva-buildings">

  <script>
    /**
     * `uva-buildings`
     * Helper component to list buildings on grounds
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class UvaBuildings extends Polymer.Element {
      static get is() { return 'uva-buildings'; }
      static get properties() {
        return {
          key: {
            type: String
          },
          buildings: {
            type: Array,
            value: function(){return [];},
            readOnly: true,
            notify: true
          },
          building: {
            type: Object,
            computed: "_firstBuilding(buildings)",
            notify: true
          },
          name: {
            type: String
          },
          id: {
            type: String
          },
          categories: {
            type: Array,
            value: function(){return [];},
            readOnly: true,
            notify: true
          },
          category: {
            type: String,
            observer: "_fetchBuildings"
          }
        };
      }
      ready() {
        super.ready();
        this._fetchBuildings();
        this._fetchCategories();
      }
      _fetchCategories() {
        var url = "https://api.library.virginia.edu/devhub/categories";
        fetch(url).then(function(response){
          return response.json();
        }).then(function(data){
          if (data && Array.isArray(data)) {
            this._setCategories(data);
          }
        }.bind(this));
      }
      _fetchBuildings() {
        if (this.key ) {
          var url = "https://api.library.virginia.edu/devhub/";
          if (this.id) {
            url += "buildingId/"+this.id;
          } else if (this.name) {
            url += "buildings/"+this.name;
          } else if (this.category) {
            url += "categories/"+this.category;
          } else {
            url += "buildings";
          }
          fetch(url).then(function(response){
            return response.json();
          }).then(function(data){
            if (data) {
              if (Array.isArray(data)) {
                this._setBuildings(data);
              } else {
                this._setBuildings(new Array(data));
              }
            }
          }.bind(this));
        }
      }
      _firstBuilding() {
        return (this.buildings && this.buildings.length > 0)?
          this.buildings[0]:
          null;
      }
    }

    window.customElements.define(UvaBuildings.is, UvaBuildings);
  </script>
</dom-module>
